'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.formatMessage = formatMessage;

var _invariant = require('invariant');

var _invariant2 = _interopRequireDefault(_invariant);

var _logger = require('@bone/logger');

var _logger2 = _interopRequireDefault(_logger);

var _object = require('./object');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var log = (0, _logger2.default)('Intl');
var idReg = /^[\w\-]+(?:\.[\w\-]+)*$/;
var messageReg = /\{\s*([\w\-]+)\s*\}/g;

/**
 * 获取国际化后的 message
 * @param {Object} [message] 国际化 message 库
 * @param {String} [id] 获取对应 message 用的属性名
 * @param {Object} [values] 填补 message 中的占位符
 * @param {Object} [options] 国际化用的其它选项
 * @param {String} [options.defaultMessage] 找不到 message 时，默认显示的 message
 **/
function formatMessage(message, id) {
  var values = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};
  var options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};

  (0, _invariant2.default)(id, 'An id must be provided to format a message');
  (0, _invariant2.default)(idReg.test(id), 'Id "' + id + '": format not correct, for detail, please refer to "https://npm.aliplus.com/package/@bone/intl"');
  (0, _invariant2.default)((0, _object.isPlainObject)(values), 'Expected values to be a plain object');
  (0, _invariant2.default)((0, _object.isPlainObject)(options), 'Expected options to be a plain object');

  var messageItem = message[id] || options.defaultMessage || undefined;
  if (!messageItem) {
    return '';
  }

  return messageItem.replace(messageReg, function (match, name) {
    if (name in values) {
      return values[name];
    } else {
      log.warn('Message "' + messageItem + '" expects prop "' + name + '" to be in values');
      return match;
    }
  });
}