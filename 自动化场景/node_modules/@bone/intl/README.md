# Bone Intl

Bone 国际化解决方案，服务于 IoT 行业

![](https://npm.aliplus.com/badge/v/@bone/intl.svg)
![](https://npm.aliplus.com/badge/d/@bone/intl.svg)

# 输入范式

```jsx
const messages = {
  zh: {
    'a.b.c.d': '你好',
    ...
  },
  en: {
    'a.b.c.d': 'Hello',
    ...
  },
};
```

1. a 标识插件
2. b 标识页面
3. c 标识页面上某一具体的区域或模块
4. d 标识具体的国际化项
5. 现有的国际化方案是本地方案，**a、b & c 非必须，考虑到未来提供平台配置和动态加载的能力，在此进行 a、b & c 的预设**
6. **a、b、c & d 只能是数字、字母、-（连字符）和 _（下划线）**

# API 文档

## IntlProvider

国际化容器组件，**支持实时修改 locale & messages**

| 属性 | 说明 | 类型 | 必选 | 默认值 |
| --- | --- | --- | --- | --- |
| locale | 区域设置，国际化语言库的 key | String | 否 | 'zh' |
| messages | 国际化语言库 | Object | 否 | {} |
| children | 子元素，**只能存在一个 child** | React.Element | 是 | 无 |

```jsx
render() {
  return (
    <IntlProvider locale="zh" messages={{
      zh: { title: '首页', people: '{count}个人' },
      en: { title: 'Home', people: '{count} people' },
    }}>
      <YourComp />
    </IntlProvider>
  );
}
```

| 静态属性 | 说明 | 类型 | 必选 | 默认值 |
| --- | --- | --- | --- | --- |
| locale | **直接挂载在 IntlProvider 类上，支持 setter & getter** | String | 否 | 'zh' |
| messages | **直接挂载在 IntlProvider 类上，支持 setter & getter** | Object | 否 | {} |

```jsx
IntlProvider.locale = 'zh';
IntlProvider.messages = {
  zh: { title: '首页', people: '{count}个人' },
  en: { title: 'Home', people: '{count} people' },
};
```

**组件实例属性的优先级高于静态属性**

**如果想要同时控制多个 IntlProvider，不指定组件的属性，使用类的静态属性即可**

## connectIntl

国际化 HOC 函数，返回一个可以和 IntlProvider 交互的组件

| 属性 | 说明 | 类型 | 必选 | 默认值 |
| --- | --- | --- | --- | --- |
| WrappedComponent | 被包裹的组件 | React.Component | 是 | 无 |
| options | 一些辅助选项 | Object | 否 | {} |
| options.intlPropName | 传递给 WrappedComponent 的 intl 属性的属性名 | String | 否 | 'intl' |
| options.ref | 获取 WrappedComponent 实例引用的函数 | Function | 否 | noop |

```jsx
const ConnectedComp = connectIntl(YourComp, {
  intlPropName: 'intl',
  ref: el => console.log(el),
});
```

## this.props.intl

使用 connectIntl 连接后的组件，默认会有 intl 这个属性（具体属性名取决于 intlPropName）

### intl.formatMessage

获取国际化后的 message 函数

| 属性 | 说明 | 类型 | 必选 | 默认值 |
| --- | --- | --- | --- | --- |
| id | 国际化语言库中 message 的 key, .e.g 'title' | String | 是 | 无 |
| values | key value 键值对，用于填补 message 中定义的参数，.e.g message: '{count}个人'，values: { count: 2 } | Object | 否 | {} |
| options | 一些辅助选项 | Object | 否 | {} |
| options.defaultMessage | 当在国际化语言库中找不到 message 时，使用默认 message | String | 否 | 无 |

```jsx
class YourComp extends Component {
  render() {
    return <div>{this.props.intl.formatMessage('people', { count: 2 })}</div>;
  }
}
```

### intl.switchLocale

修改国际化的区域设置，**如果对应的 Provider 的区域设置发生变化，会 overwrite 此次修改**

| 属性 | 说明 | 类型 | 必选 | 默认值 |
| --- | --- | --- | --- | --- |
| locale | 区域设置，国际化语言库的 key | String | 是 | 无 |

```jsx
class YourComp extends Component {
  render() {
    return <button onClick={() => this.props.intl.switchLocale('en')}>切换到英文</button>;
  }
}
```

## IntlText

可以直接和 IntlProvider 交互的组件

| 属性 | 说明 | 类型 | 必选 | 默认值 |
| --- | --- | --- | --- | --- |
| tagName | 在 Web 应用中，可指定实际渲染的 DOM 的 tagName，.e.g 'div'、'span'、'button'... **在 RN 应用中，无此属性，RN 中默认渲染 Text 组件** | String | 否 | 'span' |
| id | 国际化语言库中 message 的 key, .e.g 'title' | String | 是 | 无 |
| values | key value 键值对，用于填补 message 中定义的参数，.e.g message: '{count}个人'，values: { count: 2 } | Object | 否 | {} |
| options | 一些辅助选项 | Object | 否 | {} |
| options.defaultMessage | 当在国际化语言库中找不到 message 时，使用默认 message | String | 否 | 无 |

```jsx
render() {
  return <IntlText id="people" values={{ count: 2 }} />
}
```

# 代码示例

[Mobile 中的使用](http://gitlab.alibaba-inc.com/bone/intl/tree/master/example/mobile)

[Web 中的使用](http://gitlab.alibaba-inc.com/bone/intl/tree/master/example/web)

[静态属性，全局控制的使用](http://gitlab.alibaba-inc.com/bone/intl/tree/master/example/web-global)

## 简单的 Sample

```jsx
import React, { Component } from 'react';
import { IntlProvider, IntlText, connectIntl } from '@bone/intl';

IntlProvider.locale = 'zh';
IntlProvider.messages = {
  zh: { people: '{count}个人' },
  en: { people: '{count} people' },
};

class Text extends Component {
  render() {
    return <div>{this.props.intl.formatMessage('people', { count: 2 })}</div>;
  }
}

const ConnectedText = connectIntl(Text);

export default class App extends Component {
  render() {
    return (
      <IntlProvider>
        <div>
          <ConnectedText />
          <IntlText
            className=""
            style={{}}
            tagName="div"
            id="people"
            values={{ count: 2 }}
          />
        </div>
      </IntlProvider>
    );
  }
}
```
